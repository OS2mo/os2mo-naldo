<script>
  import { page } from "$app/stores"
  import { date } from "$lib/stores/date"
  import { base } from "$app/paths"
  import { gql } from "graphql-request"
  import { graphQLClient } from "$lib/util/http"
  import HeadTitle from "$lib/components/shared/head_title.svelte"
  import TenseTabs from "$lib/components/shared/tense_tabs.svelte"
  import { FacetDocument } from "./query.generated"
  import ClassTable from "$lib/components/tables/ClassTable.svelte"
  import TableTensesWrapper from "$lib/components/tables/TableTensesWrapper.svelte"

  gql`
    query Facet($facet_user_key: [String!], $fromDate: DateTime) {
      facets(filter: { user_keys: $facet_user_key, from_date: $fromDate }) {
        objects {
          objects {
            user_key
            uuid
          }
        }
      }
    }
  `
</script>

<!-- TODO: admin HeadTitle -->
<!-- <HeadTitle type="admin" /> -->

<div class="px-12 pt-6">
  {#await graphQLClient().request( FacetDocument, { facet_user_key: "engagement_job_function", fromDate: $date } )}
    <p>Loader medarbejder...</p>
  {:then data}
    {@const facet = data.facets.objects[0].objects[0]}
    <h1 class="mb-4">
      Stillingsbetegnelser ({facet.user_key})
    </h1>

    <div class="flex justify-between">
      <TenseTabs />
      <a
        class="btn btn-sm btn-primary rounded normal-case font-normal text-base text-base-100 my-5"
        href={`${base}/admin/create/class`}
      >
        Tilf√∏j Stillingsbetegnelse
      </a>
    </div>
    <TableTensesWrapper
      table={ClassTable}
      headers={[
        { title: "Navn", sortPath: "name" },
        { title: "Userkey", sortPath: "user_key" },
        { title: "Dato", sortPath: "validity.from" },
        { title: "" },
      ]}
    />
  {/await}
</div>
